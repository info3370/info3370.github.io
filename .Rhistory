gss_prepared |>
ggplot(aes(x = class, weight = wtssall)) +
geom_bar(stat = "prop")
?stat_count
gss_prepared |>
group_by(class) |>
summarize(weight = sum(wtssall)) |>
mutate(prop = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion)) +
geom_bar(stat = "identity")
gss_prepared |>
group_by(class) |>
summarize(weight = sum(wtssall)) |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion)) +
geom_bar(stat = "identity")
gss_prepared |>
group_by(class, respondent_college) |>
summarize(weight = sum(wtssall)) |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = respondent_college)) +
geom_bar(stat = "identity")
gss_prepared |>
group_by(class, respondent_college) |>
summarize(weight = sum(wtssall)) |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = respondent_college)) +
geom_bar(stat = "identity", position = "dodge")
gss_prepared |>
group_by(respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = respondent_college)) +
geom_bar(stat = "identity", position = "dodge")
# Plot 3: Class by parent and own education
gss_prepared |>
group_by(parent_college, respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid(parent_college ~ respondent_college)
# Plot 3: Class by parent and own education
gss_prepared |>
mutate(parent_college = ifelse(parent_college, "Parent college", "Parent no college")) |>
mutate(respondent_college = ifelse(respondent_college, "Respondent college", "Respondent no college")) |>
group_by(parent_college, respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid(parent_college ~ respondent_college)
# Plot 3: Class by parent and own education
gss_prepared |>
mutate(parent_college = ifelse(parent_college, "Parent college", "Parent no college")) |>
mutate(respondent_college = ifelse(respondent_college, "Respondent college", "Respondent no college")) |>
group_by(parent_college, respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = parent_college)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid( ~ respondent_college)
# Plot 3: Class by parent and own education
gss_prepared |>
mutate(parent_college = ifelse(parent_college, "Parent college", "Parent no college")) |>
mutate(respondent_college = ifelse(respondent_college, "Respondent college", "Respondent no college")) |>
group_by(parent_college, respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = parent_college)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid( ~ respondent_college) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
gss |>
filter(wtssall > 0) |>
print(n = 0) |>
filter(padeg >= 0 & madeg >= 0) |>
print(n = 0) |>
filter(degree >= 0) |>
print(n = 0) |>
filter(class %in% 1:4) |>
print(n = 0)
print_rows <- function(.data, comment = "Dropped cases:") {
print(paste(comment,nrow(.data)))
return(.data)
}
gss_restricted <- gss |>
filter(wtssall > 0) |>
print_rows() |>
filter(padeg >= 0 & madeg >= 0) |>
print(n = 0) |>
filter(degree >= 0) |>
print(n = 0) |>
filter(class %in% 1:4) |>
print(n = 0)
print_rows <- function(.data, comment = "Cases kept:") {
print(paste(comment,prettyNum(nrow(.data), big.mark = ",")))
return(.data)
}
gss_restricted <- gss |>
filter(wtssall > 0) |>
print_rows() |>
filter(padeg >= 0 & madeg >= 0) |>
print(n = 0) |>
filter(degree >= 0) |>
print(n = 0) |>
filter(class %in% 1:4) |>
print(n = 0)
gss_restricted <- gss |>
filter(wtssall > 0) |>
print_rows(comment = "Positive weights") |>
filter(padeg >= 0 & madeg >= 0) |>
print_rows(comment = "Has parents' degree") |>
filter(degree >= 0) |>
print_rows(comment = "Has own degree") |>
filter(class %in% 1:4) |>
print_rows(comment = "Has own subjective class")
# Plot 1: Everyone identifies as working or middle class
gss_prepared |>
group_by(class) |>
summarize(weight = sum(wtssall)) |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion)) +
geom_bar(stat = "identity")
# Plot 2: College educated people identify as middle class
gss_prepared |>
group_by(respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = respondent_college)) +
geom_bar(stat = "identity", position = "dodge")
# Plot 3: Class by parent and own education
gss_prepared |>
mutate(parent_college = ifelse(parent_college, "Parent college", "Parent no college")) |>
mutate(respondent_college = ifelse(respondent_college, "Respondent college", "Respondent no college")) |>
group_by(parent_college, respondent_college, class) |>
summarize(weight = sum(wtssall), .groups = "drop_last") |>
mutate(proportion = weight / sum(weight)) |>
ggplot(aes(x = class, y = proportion, fill = parent_college)) +
geom_bar(stat = "identity", position = "dodge") +
facet_grid( ~ respondent_college) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
temp <- gss <- read_csv("https://info3370.github.io/data/gss.csv")
gss <- read_csv("https://info3370.github.io/data/gss.csv")
gss <- read_csv("https://info3370.github.io/data/gss.csv")
pset4 <- readRDS("https://info3370.github.io/data/pset4.RDS")
?readRDS
readRDS("https://info3370.github.io/data/pset4.RDS")
readRDS(file = "https://info3370.github.io/data/pset4.RDS")
?urk
?url
readRDS(url("https://info3370.github.io/data/pset4.RDS"))
setwd("~/Dropbox/github/info3370.github.io/topics")
parents <- read_csv("https://info3370.github.io/data/parents.csv")
library(tidyverse)
library(scales)
library(haven)
parents <- read_csv("https://info3370.github.io/data/parents.csv")
parents
target_population <- tibble(sex = "female", child_age = 0)
predict(model, newdata = target_population)
model <- lm(at_work ~ sex * child_age, data = parents)
target_population <- tibble(sex = "female", child_age = 0)
predict(model, newdata = target_population)
gss <- read_csv("https://info3370.github.io/data/gss.csv")
class()
summary(class)
summary(gss)
gss |>
# drop cases with invalid outcome or negative weight
filter(class > 0 & class < 5 & wtssall > 0) |>
# calculate total weight within each class
group_by(class) |>
summarize(prop = sum(wtssall), .groups = "drop") |>
# convert to proportion of total across all classes
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
geom_bar(stat = "identity") +
geom_text(aes(y = .005, label = scales::label_percent(accuracy = 1)(prop)), color = "white",
vjust = 0) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(y = .005, label = scales::label_percent(accuracy = 1)(prop)), color = "white",
vjust = 0) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(y = .005, label = scales::label_percent(accuracy = 1)(prop)), color = "white",
vjust = 0) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)), color = "white",
vjust = 0) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)), color = "white",
vjust = -.1) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)), color = "white",
vjust = -.x) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)),
vjust = -.x) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)),
vjust = -.2) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(padeg %in% 0:4 | madeg %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Respondent Has a Four-Year Degree",
degree %in% 0:2 ~ "Respondent Has No Four-Year Degree",
)) |>
mutate(parent_college = case_when(
padeg %in% 3:4 | madeg %in% 3:4 ~ "Parent Has a Four-Year Degree",
T ~ "No Parent Has No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_grid(parent_college ~ college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)),
vjust = -.2) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(padeg %in% 0:4 | madeg %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(child_college = case_when(
degree %in% 3:4 ~ "Respondent Has a Four-Year Degree",
degree %in% 0:2 ~ "Respondent Has No Four-Year Degree",
)) |>
mutate(parent_college = case_when(
padeg %in% 3:4 | madeg %in% 3:4 ~ "Parent Has a Four-Year Degree",
T ~ "No Parent Has No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(parent_college, child_college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(parent_college, child_college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_grid(parent_college ~ child_college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)),
vjust = -.2) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(padeg %in% 0:4 | madeg %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(child_college = case_when(
degree %in% 3:4 ~ "Respondent Has a Four-Year Degree",
degree %in% 0:2 ~ "Respondent Has No Four-Year Degree",
)) |>
mutate(parent_college = case_when(
padeg %in% 3:4 | madeg %in% 3:4 ~ "Parent Has a Four-Year Degree",
T ~ "No Parent Has No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(parent_college, child_college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(parent_college, child_college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_grid(parent_college ~ child_college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)),
vjust = -.2) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
ylim(c(0,1)) +
xlab("Class")
gss |>
# drop cases with invalid outcome, predictor, or negative weight
filter(class > 0 & class < 5) |>
filter(degree %in% 0:4) |>
filter(wtssall > 0) |>
# create indicator of collge degree
# see codes at https://gssdataexplorer.norc.org/variables/59/vshow
mutate(college = case_when(
degree %in% 3:4 ~ "Holds a Four-Year Degree",
degree %in% 0:2 ~ "No Four-Year Degree",
)) |>
# calculate total weight within each class
group_by(college, class) |>
summarize(prop = sum(wtssall), .groups = "drop_last") |>
# convert to proportion of total across all classes within college degrees
group_by(college) |>
mutate(prop = prop / sum(prop)) |>
ggplot(aes(x = class, y = prop)) +
facet_wrap(~college) +
geom_bar(stat = "identity") +
geom_text(aes(label = scales::label_percent(accuracy = 1)(prop)),
vjust = -.2) +
scale_x_continuous(
breaks = 1:4,
labels = c("Lower\nClass","Working\nClass","Middle\nClass","Upper\nClass")
) +
ylab("Proportion Identifying with Each Class") +
ylim(c(0,1)) +
xlab("Class")
