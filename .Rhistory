setwd("~/Dropbox/github/info3370.github.io_desktop/topics")
library(tidyverse)
estimator <- function(data, weight_name) {
data |>
summarize(
estimate = weighted.mean(
x = employed,
# extract the weight column
w = sim_rep |> pull(weight_name)
)
) |>
# extract the scalar estimate
pull(estimate)
}
estimate <- estimator(data = sim_rep, weight_name = "weight")
library(haven)
library(foreach)
cps_data <- read_dta("../data_raw/cps_00079.dta")
cps_data <- read_dta("../data_raw/cps_00079.dta")
estimator <- function(data, weight_name) {
data |>
# Define focal_weight to hold the selected weight
mutate(focal_weight = data |> pull(weight_name)) |>
# Restrict to those age 25+
filter(age >= 25) |>
# Restrict to valid reports of education
filter(educ > 1 & educ < 999) |>
# Define a binary outcome: a four-year degree
mutate(college = educ >= 110) |>
# Estimate weighted means by sex
group_by(sex) |>
summarize(estimate = weighted.mean(
x = college,
w = focal_weight
))
}
estimate <- estimator(data = cps_data, weight_name = "asecwt")
estimate
replicate_estimates <- foreach(r = 1:160, .combine = "rbind") %do% {
estimator(data = cps_data, weight_name = paste0("repwtp",r))
}
replicate_estimates
replicate_estimates
replicate_estimates |>
left_join(estimate |> rename(point = estimate),
by = by_join(sex))
replicate_estimates |>
left_join(estimate |> rename(point = estimate),
by = join_by(sex))
standard_error <- replicate_estimates |>
rename(estimate_star = estimate) |>
left_join(estimate,
by = join_by(sex)) |>
group_by(sex) |>
summarize(standard_error = sqrt(4 / 160 * sum((estimate_star - estimate) ^ 2)))
standard_error <- replicate_estimates |>
group_by(sex) |>
summarize(standard_error = sd(estimate))
standard_error <- replicate_estimates |>
rename(estimate_star = estimate) |>
left_join(estimate,
by = join_by(sex)) |>
group_by(sex) |>
summarize(standard_error = sqrt(4 / 160 * sum((estimate_star - estimate) ^ 2)))
standard_error
result <- estimate |>
left_join(standard_error, by = "sex") |>
mutate(ci_min = estimate - 1.96 * standard_error,
ci_max = estimate + 1.96 * standard_error)
result
result |>
mutate(sex = as_factor(sex)) |>
ggplot(aes(
x = sex,
y = estimate,
ymin = ci_min,
ymax = ci_max,
label = scales::percent(estimate)
)) +
geom_errorbar(width = .2) +
geom_label() +
scale_x_discrete(
name = "Sex",
labels = str_to_title
) +
scale_y_continuous(name = "Proportion with 4-Year College Degree") +
ggtitle(
"Sex Disparities in College Completion",
subtitle = "Estimates from the 2023 CPS-ASEC among those age 25+"
)
