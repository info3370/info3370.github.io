---
layout: page
nav_order: 2
title: Data analysis
description: Data analysis
grand_parent: Topics
parent: Wealth inequality
---

# Data analysis. Survey of Consumer Finances

In this exercise, we will look at the distribution of wealth across U.S.
households in 2019, using data from the Survey of Consumer Finances. The
file [`scf.csv`](../assets/data/scf.csv) contains data which were
prepared by [this code](../assets/data/scf.R). We define wealth as
household net worth. For future reference, you can access the full
dataset through [Berkeley Survey Documentation and
Analysis](https://sda.berkeley.edu/sdaweb/analysis/?dataset=scfcomb2019).

## Data and helper functions

You can load data with this line.

``` r
scf <- read_csv("https://info3370.github.io/assets/data/scf.csv")
```

You will want a weighted quantile function that accepts

- a vector `x` to be summarized
- a quantile `q` to report (e.g., `q = .5` for the median)
- a vector `w` of survey weights (e.g., `w = weight`)

Here is a function you can copy.

``` r
# Function to estimate quantiles with sampling weights
# x is the variable being summarized (e.g., wealth)
# q is the quantile (e.g., median is q = 0.5)
# w is the survey weights
weighted.quantile <- function(x, q = .5, w = rep(1,length(x))) {
  # Sort the weights by x
  w <- w[order(x)]
  # Sort x by x
  x <- x[order(x)]
  # Calculate the cumulative distribution function
  # at each observed data point
  cdf <- cumsum(w) / sum(w)
  # Find the first index where the CDF exceeds the quantile cutoff
  first_index <- min(which(cdf > q))
  # Return the x-value at that index
  return(x[first_index])
}
```

## Ratio of 75th to 25th percentile

We will first look at overall inequality. You will

1.  take the 25th percentile of the wealth distribution
2.  take the 75th percentile of the wealth distribution
3.  take the ratio: (2) / (1)

What do you think that ratio is? Write down a guess.

> Point of reference: If we were looking at income, the ratio would be
> 3.5.

Now calculate the ratio.

## Ratio of Black median to white median

Next, we will calculate

1.  the median wealth of Black households
2.  the median wealth of white households
3.  the ratio (2) / (1)

What do you think that ratio is? Write down a guess.

> Point of reference: If we were looking at income, the ratio would be
> 1.7.

Now calculate the ratio.

## Proportion with low and high wealth

Within each category of race, what proportion of have wealth

- less than \$10,000?
- greater than \$100,000?

Write down a guess, then calculate an estimate.

## Challenge

For each wealth value \$10k, \$20k, â€¦, \$200k, what proportion of
households have income above that cutoff

- among Black households?
- among White households?

Try making a `ggplot()` where the

- `x`-axis is the wealth cutoff
- `y`-axis is the proportion of households exceeding that cutoff
- color indicates race