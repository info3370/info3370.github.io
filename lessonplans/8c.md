---
layout: page
nav_order: 3
title: Nonparametric estimators
description: Nonparametric estimators
grand_parent: Topics
parent: Interventions
---

# Nonparametric (model-free) estimators of causal effects


This page illustrates nonparametric adjustment: how to estimate causal
effects without any statistical model at all. Although it is rarely used
in practice, nonparametric adjustment is a conceptually useful because
it illustrates the ideal case that we hope any statistical model will
approximate.

We illustrate nonparametric adjustment by estimating the causal effect
of education on income, where we assume that the causal effect is
identified by statistical adjustment for parent education.

First, prepare the environment and load data we used in the [PSID
Prediction
Challenge](https://www.openicpsr.org/openicpsr/project/185941).

``` r
library(tidyverse)
d <- read_csv("../psid_mobility_challenge/for_students/learning.csv") %>%
  # Optional: Modify g2_educ so that it is an ordered factor
  mutate(g2_educ = fct_relevel(g2_educ, 
                               "Less than high school",
                               "High school",
                               "Some college",
                               "College")) %>%
  # Optional: Rename variables to their roles for this lesson
  rename(id = g3_id,
         confounder = g2_educ,
         treatment = g3_educ,
         outcome = g3_log_income) %>%
  select(id, confounder, treatment, outcome) %>%
  print()
```

    ## # A tibble: 1,365 × 4
    ##       id confounder            treatment             outcome
    ##    <dbl> <fct>                 <chr>                   <dbl>
    ##  1     1 Less than high school High school             10.7 
    ##  2     4 High school           Some college            11.5 
    ##  3     7 High school           High school             11.2 
    ##  4     9 Less than high school High school             10.7 
    ##  5    10 Less than high school High school             10.7 
    ##  6    11 High school           Some college            11.3 
    ##  7    12 High school           Some college            11.5 
    ##  8    13 Less than high school Less than high school    9.99
    ##  9    19 High school           Less than high school   11.1 
    ## 10    21 High school           Less than high school   10.4 
    ## # … with 1,355 more rows

### Nonparametric adjustment: The big idea

Suppose that parent education is the only confounder. To adjust
nonparametrically,

1.  take subgroups defined by
    - the confounder: parent education
    - the treatment: respondent education
2.  take the mean outcome in each subgroup
3.  `pivot_wider` to compare across treatment values within each
    confounder subgroup

### Details with code examples

First, estimate conditional average outcomes ine ach subgroup

``` r
conditional_average_outcomes <- d %>%
  group_by(confounder, treatment) %>%
  summarize(ybar = mean(outcome),
            .groups = "drop") %>%
  pivot_wider(names_from = treatment, values_from = ybar) %>%
  print()
```

    ## # A tibble: 4 × 5
    ##   confounder            College `High school` `Less than high school` Some col…¹
    ##   <fct>                   <dbl>         <dbl>                   <dbl>      <dbl>
    ## 1 Less than high school    11.5          10.8                    10.5       11.3
    ## 2 High school              11.6          11.0                    11.1       11.3
    ## 3 Some college             11.7          11.2                    10.6       11.3
    ## 4 College                  11.7          11.4                    11.1       11.2
    ## # … with abbreviated variable name ¹​`Some college`

Next, examine the effect of whether the respondent finished college as
opposed to only high school, within each subgroup defined by parent
education. This is a conditional average causal effect.

``` r
conditional_average_effect <- conditional_average_outcomes %>%
  mutate(effect_of_college = `College` - `High school`) %>%
  select(confounder, effect_of_college) %>%
  print()
```

    ## # A tibble: 4 × 2
    ##   confounder            effect_of_college
    ##   <fct>                             <dbl>
    ## 1 Less than high school             0.740
    ## 2 High school                       0.543
    ## 3 Some college                      0.439
    ## 4 College                           0.304

To estimate the population average causal effect, take a weighted
average of the conditional average causal effects where each subgroup
defined by the confounder is weighted by its size.

First, calculate the size of each subgroup.

``` r
subpopulation_size <- d %>%
  group_by(confounder) %>%
  summarize(subgroup_size = n(),
            .groups = "drop") %>%
  print()
```

    ## # A tibble: 4 × 2
    ##   confounder            subgroup_size
    ##   <fct>                         <int>
    ## 1 Less than high school           192
    ## 2 High school                     664
    ## 3 Some college                    296
    ## 4 College                         213

Then, estimate the conditional average effect.

``` r
conditional_average_effect %>%
  left_join(subpopulation_size, by = "confounder") %>%
  summarize(population_average_effect = weighted.mean(effect_of_college, 
                                                      w = subgroup_size)) %>%
  print()
```

    ## # A tibble: 1 × 1
    ##   population_average_effect
    ##                       <dbl>
    ## 1                     0.511

### Closing thoughts

Nonparametric adjustment is a useful concept because it illustrates what
we’d like to be doing: adjust for confounders by taking average outcomes
under different treatment values within subgroups defined by
confounders. In practice, there are often many confounders and
nonparametric adjustment becomes impossible. The next page discusses
parametric adjustment for those settings.
